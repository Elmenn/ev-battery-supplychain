---
phase: 01-cleanup-duplicate-implementations
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - frontend/src/components/railgun/PrivatePaymentModal.jsx
  - frontend/src/components/railgun/PrivateFundsDrawer.jsx
  - frontend/src/components/railgun/RailgunConnectionButton.jsx
  - frontend/src/components/railgun/RailgunInitializationTest.jsx
  - frontend/src/components/railgun/RailgunSimple.tsx
  - frontend/src/components/marketplace/ProductFormStep2_5_Railgun.jsx
autonomous: true

must_haves:
  truths:
    - "All components import from railgun-clean only (no legacy shim imports)"
    - "No TODO comments about 'update to new Railgun structure'"
    - "Frontend builds without errors"
    - "Frontend starts without import errors"
  artifacts:
    - path: "frontend/src/components/railgun/PrivatePaymentModal.jsx"
      provides: "Private payment UI with clean imports"
      contains: "from '../../lib/railgun-clean'"
    - path: "frontend/src/components/railgun/PrivateFundsDrawer.jsx"
      provides: "Funds management UI with clean imports"
      contains: "from '../../lib/railgun-clean'"
  key_links:
    - from: "frontend/src/components/railgun/PrivatePaymentModal.jsx"
      to: "frontend/src/lib/railgun-clean/index.js"
      via: "named imports"
      pattern: "import \\{.*\\} from '../../lib/railgun-clean'"
    - from: "frontend/src/components/railgun/PrivateFundsDrawer.jsx"
      to: "frontend/src/lib/railgun-clean/index.js"
      via: "named imports"
      pattern: "import \\{.*\\} from '../../lib/railgun-clean'"
---

<objective>
Update component imports and remove legacy workarounds

Purpose: Components currently have hacky workarounds for missing exports (TODOs, local aliases, destructuring from namespace imports). This plan cleans up all components to use proper named imports from the consolidated railgun-clean module.

Output: All components use clean imports, no legacy shim references, no workaround code
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-cleanup-duplicate-implementations/01-01-SUMMARY.md

# Railgun clean module (after Plan 01 consolidation)
@frontend/src/lib/railgun-clean/index.js

# Components to update
@frontend/src/components/railgun/PrivatePaymentModal.jsx
@frontend/src/components/railgun/PrivateFundsDrawer.jsx
@frontend/src/components/railgun/RailgunConnectionButton.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update PrivatePaymentModal.jsx imports</name>
  <files>frontend/src/components/railgun/PrivatePaymentModal.jsx</files>
  <action>
    Current problematic code (lines 9-14):
    ```javascript
    // TODO: Update to use new Railgun structure
    // Temporary legacy shim for old API
    import * as legacyRailgun from '../../lib/railgun-clean';
    const { connectRailgun, setRailgunIdentity, disconnectRailgun, refreshBalances, getAllBalances, privateTransfer, getRailgunAddressFromCredentials } = legacyRailgun;
    const paySellerV2 = privateTransfer; // Alias for now
    const checkWalletState = async () => ({ connected: false, message: 'Please update to new Railgun structure' });
    ```

    Replace with clean named imports:
    ```javascript
    import {
      connectRailgun,
      disconnectRailgun,
      setRailgunIdentity,
      refreshBalances,
      getAllBalances,
      privateTransfer,
      getRailgunAddressFromCredentials,
      checkWalletState
    } from '../../lib/railgun-clean';
    ```

    Also:
    - Remove the TODO comment
    - Remove the legacyRailgun namespace import
    - Remove the local paySellerV2 alias (use privateTransfer directly in code, or keep alias if used extensively)
    - Remove the stub checkWalletState function

    Search the file for any usage of `paySellerV2` and replace with `privateTransfer`, OR keep a simple alias after the import:
    ```javascript
    const paySellerV2 = privateTransfer;
    ```
  </action>
  <verify>
    Check no legacy patterns remain:
    grep -n "legacyRailgun\|TODO.*Railgun" frontend/src/components/railgun/PrivatePaymentModal.jsx
    Should return nothing
  </verify>
  <done>
    PrivatePaymentModal uses clean named imports
    No namespace imports, no local stubs, no TODO comments
  </done>
</task>

<task type="auto">
  <name>Task 2: Update PrivateFundsDrawer.jsx imports</name>
  <files>frontend/src/components/railgun/PrivateFundsDrawer.jsx</files>
  <action>
    Current problematic code (lines 30-32):
    ```javascript
    // TODO: Update to use new Railgun structure
    const { setSignerAndProvider, setRailgunIdentity } = await import('../../lib/railgun-clean');
    ```

    This uses dynamic import inside the refreshBalances function.

    Replace with top-level named import:
    ```javascript
    import {
      setSignerAndProvider,
      setRailgunIdentity,
      getAllBalances
    } from '../../lib/railgun-clean';
    ```

    Then update refreshBalances function:
    - Remove the dynamic import
    - Use the top-level imported functions directly
    - Remove TODO comment

    Also check line 56 for similar dynamic import of getAllBalances.
  </action>
  <verify>
    Check no dynamic imports of railgun-clean remain:
    grep -n "await import.*railgun-clean" frontend/src/components/railgun/PrivateFundsDrawer.jsx
    Should return nothing
  </verify>
  <done>
    PrivateFundsDrawer uses top-level named imports
    No dynamic imports, no TODO comments
  </done>
</task>

<task type="auto">
  <name>Task 3: Update remaining components and verify build</name>
  <files>
    frontend/src/components/railgun/RailgunConnectionButton.jsx
    frontend/src/components/railgun/RailgunInitializationTest.jsx
    frontend/src/components/railgun/RailgunSimple.tsx
    frontend/src/components/marketplace/ProductFormStep2_5_Railgun.jsx
  </files>
  <action>
    For each component:

    1. **RailgunConnectionButton.jsx** - Already has clean import (line 5):
       ```javascript
       import { connectRailgun, disconnectRailgun, restoreRailgunConnection } from '../../lib/railgun-clean';
       ```
       Verify no TODO comments, no legacy references.

    2. **RailgunInitializationTest.jsx** - Check import from bootstrap:
       ```javascript
       import { initRailgunForBrowser, stopRailgunEngineBrowser } from '../../lib/railgun-clean/bootstrap';
       ```
       This is acceptable (importing from submodule). OR update to import from index if those functions are now exported there.

    3. **RailgunSimple.tsx** - Check for any legacy imports, update if needed.

    4. **ProductFormStep2_5_Railgun.jsx** - Check import, should be:
       ```javascript
       import { connectRailgun } from '../../lib/railgun-clean';
       ```

    After all updates, run build verification:
    ```bash
    cd frontend && npm run build
    ```

    If build fails due to missing exports, document which function is missing.
  </action>
  <verify>
    Run: cd frontend && npm run build
    Build should complete without import/export errors

    Run: grep -rn "TODO.*Railgun\|legacy.*shim" frontend/src/components/
    Should return nothing
  </verify>
  <done>
    All Railgun components use clean imports from railgun-clean
    Frontend builds successfully
    No TODO comments about updating Railgun structure
  </done>
</task>

</tasks>

<verification>
1. grep -r "legacyRailgun" frontend/src/components/ returns nothing
2. grep -r "TODO.*Railgun" frontend/src/components/ returns nothing
3. No dynamic imports of railgun-clean in components (except bootstrap submodule if needed)
4. npm run build --prefix frontend completes without errors
5. npm start --prefix frontend starts without console errors about missing functions
</verification>

<success_criteria>
- All 6 Railgun-related components updated with clean imports
- No namespace imports (import * as X)
- No TODO comments about "update to new Railgun structure"
- No local stub functions overriding imports
- Frontend builds without errors
- Frontend starts without "X is not a function" errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-cleanup-duplicate-implementations/01-02-SUMMARY.md`
</output>
