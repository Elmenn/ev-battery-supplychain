---
phase: 01-cleanup-duplicate-implementations
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - frontend/src/lib/serve-html.ts (DELETE)
  - frontend/src/lib/railgun-legacy-shim.js (DELETE)
  - frontend/src/lib/railgun-browser-init.js (DELETE)
  - frontend/src/lib/railgun-stub.js (DELETE)
  - frontend/src/lib/railgun-bootstrap.js (DELETE)
autonomous: true

must_haves:
  truths:
    - "serve-html.ts is deleted (11,360 line monolith gone)"
    - "railgun-legacy-shim.js is deleted"
    - "railgun-browser-init.js is deleted"
    - "railgun-stub.js is deleted"
    - "railgun-bootstrap.js is deleted"
    - "Frontend still builds after deletions"
    - "No files import the deleted files"
  artifacts:
    - path: "frontend/src/lib/railgun-clean/"
      provides: "Single Railgun implementation directory"
      min_files: 6
  key_links:
    - from: "frontend/src/lib/railgun-clean/index.js"
      to: "@railgun-community/wallet"
      via: "SDK dependency"
      pattern: "@railgun-community"
---

<objective>
Delete legacy Railgun files and verify clean state

Purpose: With railgun-clean consolidated and all components updated, the legacy files are now dead code. This plan removes them to establish a single source of truth and reduce confusion for future development.

Output: Only railgun-clean/ and railgun/ (internal TypeScript) directories remain for Railgun functionality
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-cleanup-duplicate-implementations/01-01-SUMMARY.md
@.planning/phases/01-cleanup-duplicate-implementations/01-02-SUMMARY.md

# Files to delete (verify no imports first)
@frontend/src/lib/serve-html.ts
@frontend/src/lib/railgun-legacy-shim.js
@frontend/src/lib/railgun-browser-init.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify no remaining imports of legacy files</name>
  <files>
    frontend/src/lib/railgun-clean/
    frontend/src/components/
  </files>
  <action>
    Before deletion, verify nothing imports the files we're about to delete:

    ```bash
    # Check for imports of serve-html.ts
    grep -rn "serve-html" frontend/src/ --include="*.js" --include="*.jsx" --include="*.ts" --include="*.tsx"

    # Check for imports of railgun-legacy-shim
    grep -rn "railgun-legacy-shim" frontend/src/ --include="*.js" --include="*.jsx" --include="*.ts" --include="*.tsx"

    # Check for imports of railgun-browser-init
    grep -rn "railgun-browser-init" frontend/src/ --include="*.js" --include="*.jsx" --include="*.ts" --include="*.tsx"

    # Check for imports of railgun-stub
    grep -rn "railgun-stub" frontend/src/ --include="*.js" --include="*.jsx" --include="*.ts" --include="*.tsx"

    # Check for imports of railgun-bootstrap (root level, not railgun-clean/bootstrap)
    grep -rn "lib/railgun-bootstrap" frontend/src/ --include="*.js" --include="*.jsx" --include="*.ts" --include="*.tsx"
    ```

    If ANY imports are found:
    - Document where the import is
    - Check if it was missed in Plan 02
    - Update the importing file to use railgun-clean instead
    - Do NOT proceed with deletion until imports are resolved

    Also check railgun-clean files themselves:
    ```bash
    grep -rn "legacy-shim\|browser-init\|railgun-bootstrap\|serve-html" frontend/src/lib/railgun-clean/
    ```

    If railgun-clean imports from legacy files, those imports must be replaced first.
  </action>
  <verify>
    All grep commands return no results (no imports of files to be deleted)
  </verify>
  <done>
    Verified: No file in the codebase imports any of the legacy files
    Safe to proceed with deletion
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete legacy files</name>
  <files>
    frontend/src/lib/serve-html.ts
    frontend/src/lib/railgun-legacy-shim.js
    frontend/src/lib/railgun-browser-init.js
    frontend/src/lib/railgun-stub.js
    frontend/src/lib/railgun-bootstrap.js
  </files>
  <action>
    Delete the following files using git rm (preserves history):

    ```bash
    cd frontend/src/lib
    git rm serve-html.ts
    git rm railgun-legacy-shim.js
    git rm railgun-browser-init.js
    git rm railgun-stub.js
    git rm railgun-bootstrap.js
    ```

    Files being deleted and why:
    1. **serve-html.ts** (506,873 bytes / 11,360 lines) - Monolith Node.js file, not for browser use, context says delete entirely
    2. **railgun-legacy-shim.js** (24,858 bytes) - Old API shim, code extracted to railgun-clean
    3. **railgun-browser-init.js** (20,879 bytes) - Duplicate initialization, replaced by railgun-clean/bootstrap.js
    4. **railgun-stub.js** (339 bytes) - Empty stub, no longer needed
    5. **railgun-bootstrap.js** (2,465 bytes) - Root-level bootstrap, replaced by railgun-clean/bootstrap.js

    Also consider deleting railgun-client-browser.js if:
    - It's not imported by railgun-clean
    - Its functionality is duplicated in railgun-clean

    Check first:
    ```bash
    grep -rn "railgun-client-browser" frontend/src/lib/railgun-clean/
    ```

    If railgun-clean depends on it, keep it. If not, add to deletion list.
  </action>
  <verify>
    Run: ls frontend/src/lib/railgun*.js frontend/src/lib/serve-html.ts 2>/dev/null
    Should show only railgun-client-browser.js (if kept) or nothing

    Run: ls frontend/src/lib/railgun-clean/
    Should show the consolidated module files
  </verify>
  <done>
    Legacy files deleted:
    - serve-html.ts (11,360 lines removed)
    - railgun-legacy-shim.js (587 lines removed)
    - railgun-browser-init.js (510 lines removed)
    - railgun-stub.js (small stub removed)
    - railgun-bootstrap.js (root bootstrap removed)
  </done>
</task>

<task type="auto">
  <name>Task 3: Final build verification and documentation</name>
  <files>
    frontend/src/lib/railgun-clean/index.js
  </files>
  <action>
    1. Run full build:
    ```bash
    cd frontend && npm run build
    ```

    2. Run tests (if they exist):
    ```bash
    cd frontend && npm test -- --watchAll=false
    ```

    3. Start the app briefly to verify no runtime errors:
    ```bash
    cd frontend && npm start &
    sleep 10
    # Check console for errors
    kill %1
    ```

    4. Add module documentation header to railgun-clean/index.js:
    ```javascript
    /**
     * Railgun Clean - Single Source of Truth for Railgun Integration
     *
     * This module provides the public API for all Railgun functionality.
     * Components should import ONLY from this module.
     *
     * Phase 1 Cleanup: Consolidated from multiple legacy files
     * - Extracted working code from railgun-legacy-shim.js
     * - Replaced railgun-browser-init.js with bootstrap.js
     * - Deleted serve-html.ts monolith
     *
     * Structure:
     * - bootstrap.js: Engine initialization
     * - connection.js: Wallet connection/disconnection
     * - balances.js: Balance queries
     * - payments.js: Private transfers
     * - shield.js: Shielding operations
     * - wallet-state.js: In-memory state
     *
     * Dependencies:
     * - @railgun-community/wallet (SDK)
     * - railgun/ directory (internal TypeScript wrappers)
     *
     * @module railgun-clean
     */
    ```

    5. List final file structure for summary:
    ```bash
    find frontend/src/lib/railgun* -type f | head -20
    ```
  </action>
  <verify>
    npm run build --prefix frontend succeeds
    No console errors about missing modules
    Final structure shows only:
    - frontend/src/lib/railgun-clean/ (public API)
    - frontend/src/lib/railgun/ (internal TypeScript)
    - frontend/src/lib/railgun-client-browser.js (if kept as SDK wrapper)
  </verify>
  <done>
    Phase 1 complete:
    - Single Railgun implementation directory (railgun-clean/)
    - All legacy files deleted
    - Frontend builds and starts without errors
    - Module properly documented
  </done>
</task>

</tasks>

<verification>
1. ls frontend/src/lib/railgun*.js shows only railgun-client-browser.js (if kept) or nothing
2. ls frontend/src/lib/*.ts shows only index.ts (serve-html.ts deleted)
3. npm run build --prefix frontend completes successfully
4. npm start --prefix frontend launches without import errors
5. git status shows deleted files staged
</verification>

<success_criteria>
- serve-html.ts deleted (11,360 lines of dead code removed)
- All legacy shim files deleted (railgun-legacy-shim, browser-init, stub, bootstrap)
- Frontend builds successfully post-cleanup
- railgun-clean/ is the single source of truth
- Documentation header added to index.js
- Ready for Phase 2 (Wallet Connection)
</success_criteria>

<output>
After completion, create `.planning/phases/01-cleanup-duplicate-implementations/01-03-SUMMARY.md`
</output>
