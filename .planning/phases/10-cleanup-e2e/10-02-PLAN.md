---
phase: 10-cleanup-e2e
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/App.js
  - frontend/src/utils/vcBuilder.mjs
  - frontend/src/lib/railgun/
autonomous: true

must_haves:
  truths:
    - "App.js has no dead imports or dead handleDelivery function"
    - "App.js still renders all routes correctly"
    - "vcBuilder.mjs has no deprecated stubs (buildStage2VC, buildStage3VC)"
    - "Old frontend/src/lib/railgun/ directory (135 files) is deleted"
    - "Frontend builds without errors"
  artifacts:
    - path: "frontend/src/App.js"
      provides: "Clean app shell with only active imports"
      contains: "BrowserRouter"
    - path: "frontend/src/utils/vcBuilder.mjs"
      provides: "VC builder without deprecated stubs"
  key_links:
    - from: "frontend/src/App.js"
      to: "frontend/src/components/marketplace/ProductDetail"
      via: "Route component rendering"
      pattern: "ProductDetail"
    - from: "frontend/src/App.js"
      to: "frontend/src/views/MarketplaceView"
      via: "Route component rendering"
      pattern: "MarketplaceView"
---

<objective>
Delete dead frontend code: remove the ~150-line dead handleDelivery function and its 4 dead imports from App.js, remove deprecated vcBuilder stubs, and delete the entire old frontend/src/lib/railgun/ directory (135 unused files).

Purpose: Remove dead frontend code that references the old contract flow and deprecated VC functions. The old railgun/ directory has zero imports from any component (all use railgun-clean/).
Output: Clean App.js, clean vcBuilder.mjs, deleted old railgun directory.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-cleanup-e2e/10-CONTEXT.md
@.planning/phases/10-cleanup-e2e/10-RESEARCH.md
@frontend/src/App.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean App.js - remove dead handleDelivery and imports</name>
  <files>frontend/src/App.js</files>
  <action>
    Edit frontend/src/App.js to remove dead code:

    1. **Remove these imports (lines 9, 11, 12, 13):**
       - `import { getCurrentCid } from "./utils/web3Utils"` -- only used by handleDelivery
       - `import { signVcWithMetamask } from "./utils/signVcWithMetamask"` -- only used by handleDelivery (NOTE: signVcWithMetamask.js itself is KEPT -- ProductDetail.jsx and ProductFormStep3.jsx import other functions from it)
       - `import { buildStage3VC } from "./utils/vcBuilder.mjs"` -- deprecated stub that throws
       - `import { generateTxHashCommitmentBindingTag } from "./utils/commitmentUtils"` -- only used by handleDelivery (NOTE: commitmentUtils.js itself is KEPT -- ProductFormStep3 and vcVerifier use other exports)

    2. **Remove the entire handleDelivery function (lines 52-202):**
       Delete from `const handleDelivery = async (product) => {` through the closing `};` on line 202. This is ~150 lines of dead code that uses the old delivery flow (buildStage3VC, signVcWithMetamask, ZKP backend, old confirmDelivery).

    3. **Remove the onConfirmDelivery prop (line 226):**
       Remove `onConfirmDelivery={handleDelivery}` from the ProductDetail Route element. ProductDetail.jsx was rewritten in Phase 9 and does NOT accept or use this prop.

    4. **Also remove the `backendUrl` variable (line 50):**
       `const backendUrl = "http://localhost:5000"` -- only used by MarketplaceView prop, check if MarketplaceView actually uses it. If MarketplaceView still accepts backendUrl prop, keep the variable and the prop. If not, remove both.

    5. **Keep these imports (they are still used):**
       - React, useEffect, useState
       - BrowserRouter, Routes, Route
       - ethers
       - MarketplaceView, ProductDetail, RailgunInitializationTest
       - ProductEscrowABI (used... check if actually used after handleDelivery removal. If only used in handleDelivery, remove it too.)
       - uploadJson (check if used outside handleDelivery. If only in handleDelivery, remove it.)

    The resulting App.js should be a clean shell: imports, provider/address state, MetaMask listener useEffect, and route rendering. No business logic.
  </action>
  <verify>
    Run: `cd frontend && npx react-scripts build 2>&1 | tail -20` -- should compile successfully with no errors.
    Grep for "handleDelivery" in App.js -- should return nothing.
    Grep for "buildStage3VC" in App.js -- should return nothing.
    Grep for "onConfirmDelivery" in App.js -- should return nothing.
  </verify>
  <done>App.js is a clean routing shell with no dead code. All dead imports removed. Build succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Remove deprecated vcBuilder stubs and delete old railgun directory</name>
  <files>
    frontend/src/utils/vcBuilder.mjs
    frontend/src/lib/railgun/ (entire directory - 135 files)
  </files>
  <action>
    **vcBuilder.mjs cleanup:**
    Remove the deprecated stub functions at the bottom of the file (around lines 293-303):
    - `buildStage2VC()` -- throws "removed in v2.0 -- use appendPaymentProof instead"
    - `buildStage3VC()` -- throws "removed in v2.0 -- use appendDeliveryProof instead"

    These stubs were transitional (Phase 8 decision: throw-on-deprecated). Now that Phase 9 is complete and no callers remain (App.js handleDelivery was the last caller and is being removed in Task 1), the stubs serve no purpose.

    Do NOT modify any other part of vcBuilder.mjs. The active functions (createListingVC, appendPaymentProof, appendDeliveryProof, etc.) must remain.

    **Old railgun directory deletion:**
    Delete the entire `frontend/src/lib/railgun/` directory (135 files). This directory has ZERO imports from any component -- all components exclusively use `frontend/src/lib/railgun-clean/`. Verified by grep: no file in frontend/src/ imports from `lib/railgun/` (only from `lib/railgun-clean/`).

    Use `rm -rf frontend/src/lib/railgun/` to delete.

    DO NOT touch `frontend/src/lib/railgun-clean/` -- this is the ACTIVE implementation.
  </action>
  <verify>
    Grep for "buildStage2VC\|buildStage3VC" in vcBuilder.mjs -- should return nothing.
    Run: `ls frontend/src/lib/railgun/` -- should fail (directory deleted).
    Run: `ls frontend/src/lib/railgun-clean/` -- should succeed (active directory preserved).
    Run: `cd frontend && npx react-scripts build 2>&1 | tail -20` -- should compile successfully.
  </verify>
  <done>Deprecated vcBuilder stubs removed. Old railgun directory (135 files) deleted. railgun-clean/ preserved and working. Frontend builds.</done>
</task>

</tasks>

<verification>
1. `cd frontend && npx react-scripts build` completes without errors
2. App.js contains no references to handleDelivery, buildStage3VC, onConfirmDelivery
3. vcBuilder.mjs contains no buildStage2VC or buildStage3VC functions
4. frontend/src/lib/railgun/ directory does not exist
5. frontend/src/lib/railgun-clean/ directory still exists with all files
</verification>

<success_criteria>
- App.js reduced from ~240 lines to ~50-60 lines (clean routing shell)
- ~150 lines of dead handleDelivery code removed
- 4 dead imports removed from App.js
- 2 deprecated vcBuilder stubs removed
- 135 dead railgun files deleted
- Frontend builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/10-cleanup-e2e/10-02-SUMMARY.md`
</output>
