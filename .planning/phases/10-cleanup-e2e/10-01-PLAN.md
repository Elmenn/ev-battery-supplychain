---
phase: 10-cleanup-e2e
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - build/contracts/ProductEscrow.json
  - build/contracts/IProductEscrow.json
  - build/contracts/IProductEscrowOwner.json
  - migrations/1_initial_migration.js
  - scripts/migrate-railgun-imports.js
  - scripts/check-size.js
  - test/SimpleProductEscrow.test.js
  - test/GasMeasurement.test.js
  - test/ProductEscrow.confidential.test.js
  - test/ProductEscrow.railgun.comprehensive.test.js
  - test/ProductEscrow.railgun.test.js
  - test/EndToEndFlow.test.js
  - test/AuditorScalability.test.js
  - test/AuditorVerification.test.js
  - test/FundsAccounting.test.js
  - test/PhaseMachine.test.js
  - test/Reentrancy.test.js
  - test/StorageMeasurement.test.js
  - test/LinkableCommitment.test.js
  - test/TxHashCommitment.test.js
  - test/PurchaseTxHashCommitment.test.js
  - test/DeliveryTxHashCommitment.test.js
  - test/SecurityVCIntegrity.test.js
  - test/TransactionVerification.test.js
  - test/IPFSCaching.test.js
  - test/SecurityReplaySwap.test.js
  - test/AccessControl.test.js
  - test/BaselineComparison.test.js
  - test/FactoryPatternSavings.test.js
  - test/ProductCreation.test.js
  - test/fixtures/sample-vc-s0.json
  - test/fixtures/sample-vc-s1.json
  - test/fixtures/sample-vc-s2.json
  - test/DELIVERY_TX_HASH_COMMITMENT_TEST_README.md
autonomous: true

must_haves:
  truths:
    - "Only new contract tests remain: EscrowRedesign.test.js, EscrowBonds.test.js, EscrowTimeouts.test.js"
    - "No stale build artifacts reference deleted contracts"
    - "Active migration script (2_deploy_redesigned.js) is untouched"
    - "MaliciousReentrant.sol and ReentrancyGuard.sol are preserved"
    - "Root-level dev documentation files are removed"
    - "truffle test passes with remaining test files"
  artifacts:
    - path: "test/EscrowRedesign.test.js"
      provides: "New contract lifecycle tests"
    - path: "test/EscrowBonds.test.js"
      provides: "New contract bond/reentrancy tests"
    - path: "test/EscrowTimeouts.test.js"
      provides: "New contract timeout tests"
    - path: "migrations/2_deploy_redesigned.js"
      provides: "Active migration script"
    - path: "contracts/helpers/MaliciousReentrant.sol"
      provides: "Reentrancy test helper"
  key_links:
    - from: "test/EscrowBonds.test.js"
      to: "contracts/helpers/MaliciousReentrant.sol"
      via: "artifacts.require"
      pattern: "MaliciousReentrant"
---

<objective>
Delete dead backend code: old test files (22 files using pre-redesign contract API), stale build artifacts, old migration script, dead scripts, old test fixtures, and ~40 root-level development documentation files.

Purpose: Remove dead code that references the superseded contract interface. These files cause confusion and will fail if run.
Output: Clean test/, build/contracts/, migrations/, scripts/, and project root with only active files remaining.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-cleanup-e2e/10-CONTEXT.md
@.planning/phases/10-cleanup-e2e/10-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete old test files, build artifacts, migration, scripts, and fixtures</name>
  <files>
    test/SimpleProductEscrow.test.js
    test/GasMeasurement.test.js
    test/ProductEscrow.confidential.test.js
    test/ProductEscrow.railgun.comprehensive.test.js
    test/ProductEscrow.railgun.test.js
    test/EndToEndFlow.test.js
    test/AuditorScalability.test.js
    test/AuditorVerification.test.js
    test/FundsAccounting.test.js
    test/PhaseMachine.test.js
    test/Reentrancy.test.js
    test/StorageMeasurement.test.js
    test/LinkableCommitment.test.js
    test/TxHashCommitment.test.js
    test/PurchaseTxHashCommitment.test.js
    test/DeliveryTxHashCommitment.test.js
    test/SecurityVCIntegrity.test.js
    test/TransactionVerification.test.js
    test/IPFSCaching.test.js
    test/SecurityReplaySwap.test.js
    test/AccessControl.test.js
    test/BaselineComparison.test.js
    test/FactoryPatternSavings.test.js
    test/ProductCreation.test.js
    test/DELIVERY_TX_HASH_COMMITMENT_TEST_README.md
    test/fixtures/ (entire directory)
    build/contracts/ProductEscrow.json
    build/contracts/IProductEscrow.json
    build/contracts/IProductEscrowOwner.json
    migrations/1_initial_migration.js
    scripts/migrate-railgun-imports.js
    scripts/check-size.js
  </files>
  <action>
    Delete the following categories of dead files:

    **Old test files (22 files):** All test files that reference the pre-Phase-7 contract interface (3-param createProduct, purchasePublic, depositPurchase, revealAndConfirmDelivery). Delete ALL .test.js files in test/ EXCEPT EscrowRedesign.test.js, EscrowBonds.test.js, and EscrowTimeouts.test.js.

    Also delete:
    - test/DELIVERY_TX_HASH_COMMITMENT_TEST_README.md (documents deleted tests)
    - test/fixtures/ directory entirely (sample-vc-s0.json, s1, s2 -- old VC format fixtures used by old tests only)

    **Stale build artifacts (3 files):**
    - build/contracts/ProductEscrow.json (old contract)
    - build/contracts/IProductEscrow.json (old interface)
    - build/contracts/IProductEscrowOwner.json (old interface)

    DO NOT delete: ProductEscrow_Initializer.json, ProductFactory.json, MaliciousReentrant.json, ReentrancyGuard.json, or any OpenZeppelin artifacts (Clones.json, Context.json, Create2.json, Errors.json, Ownable.json).

    **Old migration (1 file):**
    - migrations/1_initial_migration.js (deploys without setBondAmount, uses old pattern)
    KEEP: migrations/2_deploy_redesigned.js

    **Dead scripts (2 files):**
    - scripts/migrate-railgun-imports.js (one-time Phase 1 migration, already run)
    - scripts/check-size.js (dev utility, not needed)

    Use `rm` for individual files and `rm -rf` for the fixtures directory. Use `git rm` if you prefer to stage deletions automatically.
  </action>
  <verify>
    Run: `ls test/*.test.js` -- should show exactly 3 files: EscrowRedesign, EscrowBonds, EscrowTimeouts.
    Run: `ls build/contracts/` -- should NOT contain ProductEscrow.json, IProductEscrow.json, or IProductEscrowOwner.json.
    Run: `ls migrations/` -- should show only 2_deploy_redesigned.js.
    Run: `ls test/fixtures/` -- should fail (directory deleted).
    Run: `ls scripts/` -- should be empty or not exist.
  </verify>
  <done>Only 3 new test files remain. No stale build artifacts. Active migration untouched. MaliciousReentrant.sol preserved.</done>
</task>

<task type="auto">
  <name>Task 2: Delete root-level development documentation and script files</name>
  <files>
    CHECK_NETWORK.ps1
    test_step5.ps1
    test-docker-setup.ps1
    test_full_flow_step7.js
    test-railgun-flow.js
    NUL
    ProductFactory_flat.sol
    CLONE_VERIFICATION_REPORT.md
    COMPILATION_FIXES.md
    COPY_FILES_INSTRUCTIONS.md
    diagnose_verification_failures.md
    EVALUATION_READINESS_CHECKLIST.md
    FRESH_BUILD_TEST_RESULTS.md
    JS_CONVERSION_PLAN.md
    MESSAGE_TO_SUCCESSOR.md
    MIGRATION_DECISION.md
    QUICK_SECURITY_CHECK.md
    QUICK_START_FOR_TUTOR.md
    RAILGUN_CLEANUP_COMPLETE.md
    RAILGUN_CLEANUP_COMPLETED.md
    RAILGUN_CLEANUP_PLAN.md
    RAILGUN_CLEANUP_PLAN_FINAL.md
    RAILGUN_CLEANUP_RECOMMENDATION.md
    RAILGUN_CLEANUP_SUMMARY.md
    RAILGUN_FETCH_INTERCEPTOR_ISSUE.md
    RAILGUN_FRESH_START_PLAN.md
    RAILGUN_INITIALIZATION_COMPLETE.md
    RAILGUN_INTEGRATION_ANALYSIS.md
    RAILGUN_MIGRATION_GUIDE.md
    RAILGUN_MIGRATION_PROGRESS.md
    RAILGUN_MODULAR_IMPLEMENTATION.md
    RAILGUN_STRUCTURE_ANALYSIS.md
    RAILGUN_TESTING_READY.md
    RAILGUN_WORKING_REPO_MIGRATION.md
    REPRODUCIBILITY_CHECKLIST.md
    sage.txt
    SECURITY_TEST_SUMMARY.md
    SECURITY_VERIFICATION_GUIDE.md
    START_GANACHE.md
    SUBSQUID_REMOVAL_SUMMARY.md
    TEST_DOCKER_SETUP.md
    test_step7_bug_fixes.md
    test_verification_issues.html
    TESTING_CHECKLIST.md
    TROUBLESHOOTING_FACTORY_DEPLOYMENT.md
    VERIFICATION_TIMING_EXPLANATION.md
    WIRING_STATUS.md
    commit_message.txt
  </files>
  <action>
    Delete all root-level development documentation, script, and artifact files that accumulated during development. These are NOT needed for the final project.

    Delete every file listed in the files section above. Use `rm` commands.

    DO NOT delete: README.md, truffle-config.js, package.json, package-lock.json, docker-compose.yml, .gitignore, or any directory.

    After deletion, verify the root directory contains only: README.md, truffle-config.js, package.json, package-lock.json, docker-compose.yml, and the project directories (backend/, build/, contracts/, docs/, frontend/, ganache-db/, migrations/, node_modules/, scripts/, test/, zkp-backend/, .planning/, .claude/).
  </action>
  <verify>
    Run: `ls *.md` in root -- should show only README.md.
    Run: `ls *.ps1 *.sol *.txt *.html *.js` in root -- should show only truffle-config.js (or nothing extra).
    Run: `ls NUL` -- should fail (deleted).
  </verify>
  <done>Root directory contains only essential project files. All ~47 development documentation and script files removed.</done>
</task>

</tasks>

<verification>
1. `ls test/*.test.js | wc -l` returns 3
2. `ls build/contracts/` shows only: Clones.json, Context.json, Create2.json, Errors.json, MaliciousReentrant.json, Ownable.json, ProductEscrow_Initializer.json, ProductFactory.json, ReentrancyGuard.json
3. `ls migrations/` shows only 2_deploy_redesigned.js
4. Root directory has no .ps1, RAILGUN_*.md, or other dev documentation files
5. `npx truffle compile` succeeds (contracts still compile)
</verification>

<success_criteria>
- 22 old test files deleted, 3 new test files remain
- 3 stale build artifacts deleted
- Old migration and dead scripts deleted
- ~47 root-level dev files deleted
- No active code broken by deletions
</success_criteria>

<output>
After completion, create `.planning/phases/10-cleanup-e2e/10-01-SUMMARY.md`
</output>
